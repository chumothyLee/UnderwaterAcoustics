'use strict';

var _toml = require('toml');

var _toml2 = _interopRequireDefault(_toml);

var _loaderUtils = require('loader-utils');

var _loaderUtils2 = _interopRequireDefault(_loaderUtils);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _globPages = require('../../utils/glob-pages');

var _globPages2 = _interopRequireDefault(_globPages);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/*  weak */
module.exports = function (source) {
  this.cacheable();
  var callback = this.async();
  var directory = _loaderUtils2.default.parseQuery(this.query).directory;
  var config = _toml2.default.parse(source);

  var value = {};
  value.config = config;
  value.relativePath = _path2.default.relative('.', directory);
  (0, _globPages2.default)(directory, function (err, pagesData) {
    value.pages = pagesData;
    return callback(null, 'module.exports = ' + JSON.stringify(value, null, '\t'));
  });
};